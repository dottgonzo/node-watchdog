"use strict";
var Promise = require('bluebird');
var fs = require('fs');
var systemd_services_1 = require('systemd-services');
var ns = new systemd_services_1.default();
var watchDog = (function () {
    function watchDog(o) {
        if (o)
            this.configure(o);
    }
    watchDog.prototype.configure = function (o) {
        var _this = this;
        if (!o) {
            throw Error('no configuration provided for watchdog');
        }
        else {
            if (!o.configFile)
                o.configFile = '/etc/watchdog.conf';
            _this.configFile = o.configFile;
            var conf = 'realtime = yes\n';
            conf += 'priority = 1\n';
            if (o.pings) {
                for (var i = 0; i < o.pings.length; i++) {
                    conf += 'ping = ' + o.pings[i] + '\n';
                }
            }
            if (o.hardware) {
                console.log('TODO');
            }
            fs.writeFileSync(_this.configFile, conf, { encoding: 'utf-8' });
        }
    };
    watchDog.prototype.start = function () {
        var _this = this;
        return new Promise(function (resolve, reject) {
            ns.start('watchdog').then(function (a) {
                resolve(a);
            }).catch(function (err) {
                reject(err);
            });
        });
    };
    watchDog.prototype.stop = function () {
        var _this = this;
        return new Promise(function (resolve, reject) {
            ns.stop('watchdog').then(function (a) {
                resolve(a);
            }).catch(function (err) {
                reject(err);
            });
        });
    };
    watchDog.prototype.restart = function () {
        var _this = this;
        return new Promise(function (resolve, reject) {
            _this.stop().then(function () {
                _this.start().then(function (a) {
                    resolve(a);
                }).catch(function (err) {
                    reject(err);
                });
            }).catch(function (err) {
                _this.start().then(function (a) {
                    resolve(a);
                }).catch(function (err) {
                    reject(err);
                });
            });
        });
    };
    return watchDog;
}());
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = watchDog;

//# sourceMappingURL=data:application/json;base64,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QUM7UUFDbkIsTUFBTSxDQUFDLElBQUksT0FBTyxDQUFVLFVBQUMsT0FBTyxFQUFFLE1BQU07WUFDeEMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksQ0FBQztnQkFDZCxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQUMsQ0FBQztvQkFDakIsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFBO2dCQUNkLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFDLEdBQUc7b0JBQ1QsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFBO2dCQUNmLENBQUMsQ0FBQyxDQUFBO1lBQ04sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQUMsR0FBRztnQkFDVCxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQUMsQ0FBQztvQkFDakIsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFBO2dCQUNkLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFDLEdBQUc7b0JBQ1QsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFBO2dCQUNmLENBQUMsQ0FBQyxDQUFBO1lBQ04sQ0FBQyxDQUFDLENBQUE7UUFFTixDQUFDLENBQUMsQ0FBQTtJQUVOLENBQUM7SUFHTCxlQUFDO0FBQUQsQ0F2RkEsQUF1RkMsSUFBQTtBQXZGRDswQkF1RkMsQ0FBQSIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFByb21pc2UgZnJvbSAnYmx1ZWJpcmQnO1xuXG5cbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcblxuXG5pbXBvcnQgU3lzU2VydmljZSBmcm9tICdzeXN0ZW1kLXNlcnZpY2VzJztcblxuXG5cblxuY29uc3QgbnMgPSBuZXcgU3lzU2VydmljZSgpXG5cbmludGVyZmFjZSBJV2F0Y2hkb2dDb25mIHtcbiAgICBoYXJkd2FyZT86IHN0cmluZztcbiAgICBwaW5ncz86IHN0cmluZ1tdO1xuICAgIGludGVyZmFjZT86IHN0cmluZztcbiAgICBmaWxlPzogc3RyaW5nO1xuICAgIG1heExvYWQxPzogbnVtYmVyO1xuICAgIG1heExvYWQ1PzogbnVtYmVyO1xuICAgIG1heExvYWQxNT86IG51bWJlcjtcbiAgICBtaW5NZW1vcnk/OiBudW1iZXI7XG4gICAgYWxsb2N0YWJsZU1lbW9yeT86IG51bWJlcjtcbiAgICBjb25maWdGaWxlPzogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgSVN0YXR1cyB7XG4gICAgYWN0aXZlOiBib29sZWFuO1xuICAgIGFjdGl2ZV9zdGF0dXM6IHN0cmluZztcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3Mgd2F0Y2hEb2cge1xuICAgIGNvbmZpZ0ZpbGU6IHN0cmluZztcbiAgICBjb25zdHJ1Y3RvcihvPzogSVdhdGNoZG9nQ29uZikge1xuICAgICAgICBpZiAobykgdGhpcy5jb25maWd1cmUobylcbiAgICB9XG5cbiAgICBjb25maWd1cmUobzogSVdhdGNoZG9nQ29uZikge1xuXG4gICAgICAgIGxldCBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgaWYgKCFvKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcignbm8gY29uZmlndXJhdGlvbiBwcm92aWRlZCBmb3Igd2F0Y2hkb2cnKVxuICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICBpZiAoIW8uY29uZmlnRmlsZSkgby5jb25maWdGaWxlID0gJy9ldGMvd2F0Y2hkb2cuY29uZidcbiAgICAgICAgICAgIF90aGlzLmNvbmZpZ0ZpbGUgPSBvLmNvbmZpZ0ZpbGU7XG5cbiAgICAgICAgICAgIGxldCBjb25mID0gJ3JlYWx0aW1lID0geWVzXFxuJztcbiAgICAgICAgICAgIGNvbmYgKz0gJ3ByaW9yaXR5ID0gMVxcbic7XG5cbiAgICAgICAgICAgIGlmIChvLnBpbmdzKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvLnBpbmdzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbmYgKz0gJ3BpbmcgPSAnICsgby5waW5nc1tpXSArICdcXG4nXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5oYXJkd2FyZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdUT0RPJylcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnMud3JpdGVGaWxlU3luYyhfdGhpcy5jb25maWdGaWxlLCBjb25mLCB7IGVuY29kaW5nOiAndXRmLTgnIH0pXG5cblxuICAgICAgICB9XG5cblxuXG4gICAgfVxuXG4gICAgc3RhcnQoKSB7XG4gICAgICAgIGNvbnN0IF90aGlzID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPGJvb2xlYW4+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIG5zLnN0YXJ0KCd3YXRjaGRvZycpLnRoZW4oKGEpID0+IHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKGEpXG4gICAgICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycilcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgfSlcblxuICAgIH1cblxuXG4gICAgc3RvcCgpIHtcbiAgICAgICAgY29uc3QgX3RoaXMgPSB0aGlzO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8Ym9vbGVhbj4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgbnMuc3RvcCgnd2F0Y2hkb2cnKS50aGVuKChhKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShhKVxuICAgICAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgICAgIHJlamVjdChlcnIpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuXG4gICAgfVxuXG4gICAgcmVzdGFydCgpIHtcbiAgICAgICAgY29uc3QgX3RoaXMgPSB0aGlzO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8Ym9vbGVhbj4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgX3RoaXMuc3RvcCgpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgIF90aGlzLnN0YXJ0KCkudGhlbigoYSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGEpXG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgX3RoaXMuc3RhcnQoKS50aGVuKChhKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoYSlcbiAgICAgICAgICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgfSlcblxuICAgIH1cblxuXG59XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
